<!-- creditos-views-credito.xml -->
<odoo>
    <!-- Acción de Menú (DEBE IR PRIMERO) -->
    <record id="credito_asignaciones" model="ir.actions.act_window">
        <field name="name">Asignaciones</field>
        <field name="res_model">creditos.credito</field>
        <field name="view_mode">list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Crea tu primer asignacion</p>
        </field>
    </record>

    <!-- Vista árbol -->
    <record id="view_credito_list" model="ir.ui.view">
        <field name="name">asignacion.list</field>
        <field name="model">creditos.credito</field>
        <field name="arch" type="xml">
            <list>
                <field name="folio" readonly="1"/>
                <field name="cliente"/>
                <field name="contrato"/>
                <field name="monto"/>
                <field name="vencimiento"/>
                <field name="superficie"/>
            </list>
        </field>
    </record>


    <!--record id="view_temp_statement_simulation_form" model="ir.ui.view">
        <field name="name">temp.statement.simulation.form</field>
        <field name="model">edocta</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <field name="contrato_id"/>
                    </group>
                                        
                    <notebook>
                        <page string="Resultados">
                            <field name="lines">
                                <list>
                                    <field name="fecha"/>
                                    <field name="concepto"/>
                                    <field name="cantidad"/>
                                    <field name="precio"/>
                                    <field name="iva"/>
                                    <field name="ieps"/>
                                    <field name="importe"/>
                                    <field name="cargo"/>
                                    <field name="abono"/>
                                    <field name="saldo"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record-->
    
    <record id="view_credito_detail" model="ir.ui.view">
        <field name="name">asignacion.form</field>
        <field name="model">creditos.credito</field>
        <field name="arch" type="xml">
            <form autosave="False">
                <header>
                    <button name="action_editar" string="Editar" type="object" class="oe_highlight" invisible="not id or is_editing"/>

                    <button name="action_save_and_return" string="Guardar y Volver" type="object" class="btn btn-primary" icon="fa-save" invisible="id or not is_editing"/>

                    <button name="action_autorizacion" string="Autorizar contrato" type="object" class="btn btn-primary" icon="fa-check" invisible="not id or is_editing or contratoaprobado"/>

                    <button name="action_activacion" string="Bloquear contrato" type="object" class="btn btn-primary" icon="fa-toggle-on" invisible="not id or is_editing or not contratoaprobado or not contratoactivo"/>

                    <button name="action_activacion" string="Habilitar contrato" type="object" class="btn btn-primary" icon="fa-toggle-on" invisible="not id or is_editing or not contratoaprobado or contratoactivo"/>
                    <button 
                        name="action_abrir_edocta" 
                        string="Ver Estado de Cuenta" 
                        type="object" 
                        class="btn-primary"/>
                    <!--button name="action_edocuenta2" string="Estado de Cuenta" type="object" class="oe_highlight" invisible="not id or is_editing"/-->
                </header>
                <sheet>
                    <group>
                        <span>"VISTA DETAIL"</span>
                        <field name="is_editing"/>
                        <field name="folio" readonly="1" string ="" style="font-size: 20px; font-weight: bold" invisible="not id"/>
                        <div style="height:20px"></div>
                        <field name = "contratoaprobado" widget="toggle"/>
                        <sheet invisible="not autorizaciones">
                            <field name="ultimaautorizacion_fecha" readonly = "1"/>
                            <field name="ultimaautorizacion_descripcion" readonly = "1"/>
                        </sheet>
                        <field name = "contratoactivo" widget="toggle"/>
                        <sheet invisible="not activaciones">
                            <field name="ultimaactivacion_fecha" readonly = "1"/>
                            <field name="ultimaactivacion_descripcion" readonly = "1"/>
                        </sheet>
                        <field name="cliente"/>
                        <field name="contrato"/>
                        <field name="titularr" widget="radio" options="{'horizontal': true}" readonly="not cliente or not contrato"/>
                        <field name="monto" readonly="not cliente or not contrato" widget = "monetary"/>
                        <div class="text-muted" invisible="not contrato">
                            <span invisible="tipocredito_val == '2'">
                                Cálculo automático: Aporte × Superficie
                            </span>
                            <span invisible="tipocredito_val != '2'">
                                Monto manual (Crédito Especial)
                            </span>
                        </div>
                        <field name="vencimiento" readonly="not cliente or not contrato"/>
                        <!-- CORREGIDO: Hacer editable solo para tipo "1" -->
                        <field name="superficie" readonly="not cliente or not contrato or tipocredito_val == '0'" invisible="tipocredito_val == '2'" />
                    </group>
                    <group name="datos_obligado" string="Obligado Solidario">
                        <div class="o_row" invisible="not cliente">
                            <field name="cliente_estado_civil" readonly="1"/>
                            <field name="cliente_conyugue" readonly="1" invisible="cliente_estado_civil not in ['casado', 'union_libre']"/>
                        </div>
                        <field name="obligado" readonly="not cliente or not contrato"/>
                        <field name="obligadodomicilio" readonly="not cliente or not contrato"/>
                        <field name="obligadoRFC" readonly="not cliente or not contrato"/>

                    </group>

                    <!-- CORREGIDO: Agregar campo tipocredito_val oculto para que funcione la condición -->
                    <field name="tipocredito_val" invisible="1"/>

                    <group name="cargos" string="Cargos">
                            <field name="cargos">
                                <list editable="bottom">
                                    <field name="fecha"/>
                                    <field name = "cargo"/>
                                    <field name = "tipocargo"/>
                                    <field name ="porcentaje" invisible = "tipocargo != '1'"/>
                                    <field name="costo" invisible = "tipocargo == '1'"/>
                                    <field name="importe"/>
                                </list>
                            </field>
                    </group>
                    <!-- CORREGIDO: Mostrar predios solo para tipo AVIO (tipocredito == '0') -->
                    <group name="predios" string="Predios" invisible="tipocredito_val != '0'">
                        <field name="predios" readonly="not cliente or not contrato">
                            <list editable="bottom">
                                <field name="credito_id" column_invisible="1"/>
                                <field name="es_dueno_predio" string="¿Es dueño?" width="80px"/>
                                <field name="titular" width="150px" placeholder="Nombre del titular (si no es dueño)" readonly="es_dueno_predio == 'si'"/>
                                <field name="RFC" string="RFC" width="120px"/>
                                <field name="localidad" width="120px"/>
                                <field name="superficie" string="Superficie Total" width="100px"/>
                                <field name="superficiecultivable" string="Cultivable" width="90px"/>
                                <field name="nocertificado" width="120px"/>
                                <field name="colnorte" width="90px"/>
                                <field name="colsur" width="90px"/>
                                <field name="coleste" width="90px"/>
                                <field name="coloeste" width="90px"/>
                                <!-- Aquí podrías agregar georeferencias como smart button o vista aparte -->
                            </list>
                        </field>
                    </group>

                    <!-- CORREGIDO: Mostrar garantías solo para tipo AVIO (tipocredito == '0') -->
                    <group name="garantias" string="Garantías" invisible="tipocredito_val != '0'">
                        <div class="o_row">
                            <field name="garantias" readonly="not cliente or not contrato">
                                <list editable="bottom">
                                    <field name="credito_id" column_invisible="1"/>
                                    <field name="es_dueno_garantia" string="¿Es dueño?" width="90px"/>
                                    <field name="tipo" width="120px"/>
                                    <field name="titular" width="150px" readonly="es_dueno_garantia == 'si'"/>
                                    <field name="RFC" string="RFC" width="120px"/>
                                    <field name="localidad" width="120px"/>
                                    <field name="valor" string="Valor" width="100px"/>
                                    <field name="descripcion" width="200px"/>
                                    <field name="fecha_entrega" string="F. Entrega" width="100px"/>
                                    <field name="persona_entrega" string="Entrega" width="120px"/>
                                    <field name="persona_recibe" string="Recibe" width="120px"/>
                                </list>
                            </field>
                        </div>
                    </group>
                    <group invisible="tipocredito_val != '0'">
                        <span>Total garantías: </span>
                        <field name="total_garantias" readonly="1" widget="monetary"/>
                        <span> / Monto crédito: </span>
                        <field name="monto" readonly="1" widget="monetary" nolabel="1"/>
                    </group>

                </sheet>
            </form>
        </field>
    </record>

    <record id="view_autorizacion_form" model="ir.ui.view">
        <field name="name">autorizacion.form</field>
        <field name="model">creditos.autorizacion</field>
        <field name="arch" type="xml">
            <form autosave="False">
                <sheet>
                    <group>
                        <field name="status" widget="selection_badge"/>
                        <field name="descripcion"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_activacion_form" model="ir.ui.view">
        <field name="name">activacion.form</field>
        <field name="model">creditos.activacion</field>
        <field name="arch" type="xml">
            <form autosave="False">
                <sheet>
                    <group>
                        <field name="status" widget="selection_badge"/>
                        <field name="descripcion"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!--record id="view_edodecuenta_list" model="ir.ui.view">
        <field name="name">credito.edodecuenta.list</field>
        <field name="model">cuentasxcobrar.cuentaxcobrar</field>
        
        <field name="arch" type="xml">
            <list string="Estado de cuenta">
                <field name="fecha"/>
                <field name="referencia"/>
                <field name="concepto"/>
                <field name="cantidad"/>
                <field name="precio"/>
                <field name="importe"/>
                <field name="iva"/>
                <field name="ieps"/>
                <field name="cargo"/>
                <field name="abono"/>
                <field name="saldo"/>
            </list>
        </field>
    </record-->


    <!-- Menús -->
    <menuitem id="menu_root" name="Solicitudes de Créditos" sequence="10"/>
    <menuitem id="menu_action" name="Catálogo de Solicitudes" parent="menu_root" action="credito_asignaciones"/>
</odoo>