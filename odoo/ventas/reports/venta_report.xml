<odoo>
  <data>
    <!-- ventas/reports/venta_report.xml -->
    <!-- Acción de reporte PDF -->
    <record id="action_report_venta" model="ir.actions.report">
      <field name="name">Venta</field>
      <field name="type">ir.actions.report</field>
      <field name="report_type">qweb-pdf</field>
      <!-- report_name = <módulo>.<id_del_template> -->
      <field name="report_name">ventas.report_venta_document</field>
      <field name="report_file">ventas.report_venta_document</field>
      <field name="model">ventas.venta</field>
      <field name="print_report_name">'VENTA_%s' % (object.codigo or object.display_name)</field>
      <field name="attachment_use">False</field>
      <field name="attachment">'venta_%s.pdf' % (object.codigo or object.id)</field>
    </record>

    <!-- Template QWeb base (solo cabecera y caja de foto, listo para ampliar) -->
    <template id="report_venta_document">
      <t t-call="web.basic_layout">
        <t t-foreach="docs" t-as="o">


    <title>Reporte de compra</title>
    <style>
        /* Reset y configuración base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "DejaVu Sans", Arial, sans-serif;
            font-size: 12px;
            line-height: 1.12;
            color: #000;
            background: #fff;
        }
        
        /* Marca / dirección */
        .brand .name {
            font-size: 30px;
            font-weight: 900;
            letter-spacing: 0.2px;
            text-align: center;
            margin-bottom: 8px;
        }

        .brand .addr {
            font-size: 12px;
            
            margin-top: 6px;
        }

        /* Reglas divisorias */
        .rule-strong {
            border-top: 2px solid #000;
            margin: 12px 0 14px 0;
        }

        .rule-thin {
            border-top: 1px solid #000;
            margin: 8px 0 10px 0;
        }

        /* Ajustes responsivos para PDF */
        @media print {
            body {
                margin: 0;
                padding: 0;
            }
            
            .sol-top {
                max-height: none;
                padding: 10px;
            }
        }

    </style>
<body>
    <div class="sol-top">

        <div class="brand">
            <div class="name">Hola Mundo</div>
        </div>
        <div class="rule-strong"></div>
    </div>
</body>
<div class="page">
  <h2 class="text-center">Venta <t t-esc="o.codigo or o.display_name"/></h2>

  <!-- Cabecera -->
  <div class="row mt-2">
    <div class="col-6">
      <p><strong>Fecha:</strong> <span t-field="o.fecha"/></p>
      <p><strong>Cliente:</strong> <t t-esc="o.cliente and o.cliente.nombre or ''"/></p>
      <t t-if="o.cliente and o.cliente.rfc">
        <p><strong>RFC:</strong> <t t-esc="o.cliente.rfc"/></p>
      </t>
      <t t-if="o.contrato">
        <p><strong>Contrato:</strong> <t t-esc="o.contrato.display_name"/></p>
      </t>
    </div>
    <div class="col-6">
      <p><strong>Sucursal:</strong> <t t-esc="o.sucursal_id and o.sucursal_id.nombre or ''"/></p>
      <p><strong>Código:</strong> <t t-esc="o.codigo or ''"/></p>
      <p>
        <strong>Estado:</strong>
        <t t-esc="(o._fields.get('state') and o._fields['state'].convert_to_export(o.state, o)) or ''"/>
      </p>
      <t t-if="o.solicita">
        <p><strong>Solicita:</strong> <t t-esc="o.solicita"/></p>
      </t>
    </div>
  </div>

  <t t-if="o.observaciones">
    <div class="mt-2">
      <p><strong>Observaciones:</strong> <t t-esc="o.observaciones"/></p>
    </div>
  </t>

  <!-- Detalle -->
  <table class="table table-sm o_main_table mt16">
    <thead>
      <tr>
        <th>Artículo</th>
        <th class="text-right">Cantidad</th>
        <th class="text-right">Precio</th>
        <th class="text-right">IVA</th>
        <th class="text-right">IEPS</th>
        <th class="text-right">Importe total</th>
      </tr>
    </thead>
    <tbody>
      <tr t-foreach="o.detalle" t-as="l">
        <!-- Variables seguras por línea -->
        <t t-set="product_name"
           t-value="(l._fields.get('producto') and l.producto and l.producto.display_name) or ''"/>
        <t t-set="qty"        t-value="(l._fields.get('cantidad') and (l.cantidad or 0.0)) or 0.0"/>
        <t t-set="price"      t-value="(l._fields.get('precio')   and (l.precio   or 0.0)) or 0.0"/>
        <t t-set="line_iva"   t-value="(l._fields.get('iva')      and (l.iva      or 0.0)) or 0.0"/>
        <t t-set="line_ieps"  t-value="(l._fields.get('ieps')     and (l.ieps     or 0.0)) or 0.0"/>
        <t t-set="line_total" t-value="(l._fields.get('importe')  and (l.importe  or 0.0)) or 0.0"/>

        <td><t t-esc="product_name"/></td>
        <td class="text-right"><t t-esc="qty"/></td>
        <td class="text-right"><t t-esc="price"/></td>
        <td class="text-right"><t t-esc="line_iva"/></td>
        <td class="text-right"><t t-esc="line_ieps"/></td>
        <td class="text-right"><t t-esc="line_total"/></td>
      </tr>
    </tbody>
  </table>

  <!-- Totales -->
  <div class="row mt16">
    <div class="col-6"/>
    <div class="col-6">
      <table class="table table-sm">
        <tr>
          <th>Importe</th>
          <td class="text-right"><t t-esc="o.importe or 0.0"/></td>
        </tr>
        <tr>
          <th>IVA</th>
          <td class="text-right"><t t-esc="o.iva or 0.0"/></td>
        </tr>
        <tr>
          <th>IEPS</th>
          <td class="text-right"><t t-esc="o.ieps or 0.0"/></td>
        </tr>
        <tr>
          <th>Total</th>
          <td class="text-right"><t t-esc="o.total or 0.0"/></td>
        </tr>
      </table>
    </div>
  </div>
</div>


        </t>
      </t>
    </template>

  </data>
</odoo>
